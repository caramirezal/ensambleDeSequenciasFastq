## quality control and trimming 
Rscript pipeline.R

## Filtrado de secuencias 
## lecturas con menos de 36 nt
cutadapt -o filteredData/Illumina1_filt.fq -p filteredData/Illumina2_filt.fq data/Illumina1.fq data/Illumina2.fq -m 36 
##
cutadapt \  
            -a AGATCGGAAGAGCACACGTCTGAACTCCAGTCAC   \     # adaptadores Illumina truSeq
            -A AGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGTAGATCTCGGTGGTCGCCGTATCATT \
            -o filteredData/Illumina1_filt.fastq -p filteredData/Illumina2_filt.fastq  \
            data/Illumina1.fq data/Illumina2.fq  \ ## secuencias con menos de 36 nt 
            -m 36 \             


## genome assembly
cd alignments
abyss-pe name=assignment k=36 in='filteredData/Illumina1_filt.fq filteredData/Illumina2_filt.fq' 
cd ..

## building reference genome bt formats
cd indexes
bowtie2-build ../genomes/GCA_001543975.1_G_duodenalis_AssB_BAH15c1_genomic.fna giardia_ref
cd ..
 
## fastq to sam
bowtie2 -x indexes/giardia_ref -1 data/fastq/Illumina1.fq -2 data/fastq/Illumina2.fq -S alignments/output.sam

## sam to bam conversion
samtools view -b -S -o alignments/output.bam alignments/output.sam

## sorting bam file
./scripts/samtools/samtools sort scripts/ensambleDeSequenciasFastq/alignments/output.bam -o scripts/ensambleDeSequenciasFastq/alignments/sorted_output

## indexing bam file
./scripts/samtools/samtools index scripts/ensambleDeSequenciasFastq/alignments/sorted_output.bam

## bam to fasta
samtools bam2fq alignments/sorted_output | seqtk seq -A - > alignments/output.fq

## bam to bed
bedtools bamtobed -i scripts/ensambleDeSequenciasFastq/alignments/sorted_output.bam | head -3

cd alignments
abyss-pe name=ens k=30 in='alignments/output.fq' 
cd ..

